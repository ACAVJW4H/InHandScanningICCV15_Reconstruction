// Author: Dimitrios Tzionas
//
// source code for the work:
//
// Dimitrios Tzionas and Juergen Gall
// 3D Object Reconstruction from Hand-Object Interactions
// International Conference on Computer Vision (ICCV) 2015
// http://files.is.tue.mpg.de/dtzionas/In-Hand-Scanning


#include "model.h"


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



void Model::create_Lookup_KinematicChain_AllBones()
{

        ////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////   apto telos pros tin arxi   ////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////
        BoneStruct trexonBone;

        lookup_Influence_AllBones.clear();
        lookup_Influence_AllBones.resize(totalBones);

        for (int iii=totalBones-1; iii>=0; iii--)
        {
                lookup_Influence_AllBones[ iii ].clear();
                lookup_Influence_AllBones[ iii ].resize(totalBones);
                lookup_Influence_AllBones[ iii ].fill(0);

                trexonBone = skeleton.bones[ iii ];

                lookup_Influence_AllBones[ iii ][ trexonBone.addressSeListaBones ] = 8;

                while (trexonBone.fatherAddress != -666)
                {
                        trexonBone = skeleton.bones[ trexonBone.fatherAddress ];

                        lookup_Influence_AllBones[ iii ][ trexonBone.addressSeListaBones ] = 1;
                }

        }

}



void Model::print_Lookup_KinematicChain_AllBones()  // gives the parents (j) for the bone of interest (i)
{

        for (int i=0; i<lookup_Influence_AllBones.size(); i++)
        {
                for (int j=0; j<lookup_Influence_AllBones[i].size(); j++)
                {
                        if      (lookup_Influence_AllBones[i][j]==0)          qDebug() << skeleton.bones[j].name << "\t" << lookup_Influence_AllBones[i][j];
                        else if (lookup_Influence_AllBones[i][j]==8)          qDebug() << skeleton.bones[j].name << "\t" << lookup_Influence_AllBones[i][j] << " ++++++++";
                        else                                                  qDebug() << skeleton.bones[j].name << "\t" << lookup_Influence_AllBones[i][j] << " +++";
                }

                qDebug() << "\n\n\n########################################################";
                qDebug() <<       "########################################################";
                qDebug() <<       "########################################################\n\n\n";
        }

}




/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



void Model::create_Lookup_KinematicChain_SkinnBones_2_SkinnBones()
{

        ////////////////////////////////////////////////////////////////////////////////////
        //////////////////////////   apto telos pros tin arxi   ////////////////////////////
        ////////////////////////////////////////////////////////////////////////////////////
        BoneStruct trexonBone;

        lookup_Influence_SkinnBones_2_SkinnBones.resize( totalSkinningBones );


        for (int iii=totalSkinningBones-1; iii>=0; iii--)
        {
                lookup_Influence_SkinnBones_2_SkinnBones[ iii ].resize( totalSkinningBones );
                lookup_Influence_SkinnBones_2_SkinnBones[ iii ].fill(0);

                /////////////////////////////////////////////////////////////////////////////////////

                trexonBone = skeleton.bones[ lookup_SkinningBone_to_Bones_ID[iii] ];

                /////////////////////////////////////////////////////////////////////////////////////

                lookup_Influence_SkinnBones_2_SkinnBones[ iii ][ iii ] = 8;

                /////////////////////////////////////////////////////////////////////////////////////

                while (trexonBone.fatherAddress != -666)
                {
                        trexonBone = skeleton.bones[ trexonBone.fatherAddress ];

                        if ( trexonBone.addressSeListaSKINNING > -1 )
                        {
                                lookup_Influence_SkinnBones_2_SkinnBones[ iii ][ trexonBone.addressSeListaSKINNING ] = 1;
                        }
                }

        }

}





void Model::print_Lookup_KinematicChain_SkinnBones_2_SkinnBones()
{

        for (int i=0; i<lookup_Influence_SkinnBones_2_SkinnBones.size(); i++)
        {
                for (int j=0; j<lookup_Influence_SkinnBones_2_SkinnBones[i].size(); j++)
                {
                        if      (lookup_Influence_SkinnBones_2_SkinnBones[i][j]==0)         qDebug() << skinningSkeleton.skinningBones[j].name << "\t" << lookup_Influence_SkinnBones_2_SkinnBones[i][j];
                        else if (lookup_Influence_SkinnBones_2_SkinnBones[i][j]==8)         qDebug() << skinningSkeleton.skinningBones[j].name << "\t" << lookup_Influence_SkinnBones_2_SkinnBones[i][j] << " ++++++++";
                        else                                                                qDebug() << skinningSkeleton.skinningBones[j].name << "\t" << lookup_Influence_SkinnBones_2_SkinnBones[i][j] << " +++";
                }

                qDebug() << "\n\n\n########################################################";
                qDebug() <<       "########################################################";
                qDebug() <<       "########################################################\n\n\n";
        }

}




/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

